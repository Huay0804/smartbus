{% extends "base.html" %}
{% block title %}Quản lý tuyến{% endblock %}

{% block content %}
<h2 class="mb-3">Quản lý tuyến</h2>

<form method="post" class="row g-2 mb-4">
  <input type="hidden" name="maTuyen" value="{{ edit_route.maTuyen if edit_route else '' }}">

  <div class="col-md-2">
    <input class="form-control" name="maHienThi" placeholder="Mã hiển thị (VD: 01)"
           value="{{ edit_route.maHienThi if edit_route else '' }}">
  </div>
  <div class="col-md-4">
    <input class="form-control" name="tenTuyen" placeholder="Tên tuyến"
           value="{{ edit_route.tenTuyen if edit_route else '' }}">
  </div>
  <div class="col-md-3">
    <input class="form-control" name="diemBatDau" placeholder="Điểm bắt đầu"
           value="{{ edit_route.diemBatDau if edit_route else '' }}">
  </div>
  <div class="col-md-3">
    <input class="form-control" name="diemKetThuc" placeholder="Điểm kết thúc"
           value="{{ edit_route.diemKetThuc if edit_route else '' }}">
  </div>

  <div class="col-12 col-md-2 d-grid mt-2">
    <button class="btn btn-primary">
      {{ "Cập nhật tuyến" if edit_route else "Thêm tuyến" }}
    </button>
  </div>

  {% if edit_route %}
  <div class="col-12 col-md-2 d-grid mt-2">
    <a class="btn btn-outline-secondary" href="{{ url_for('admin_routes') }}">Hủy sửa</a>
  </div>
  {% endif %}
</form>

<table class="table table-sm table-hover align-middle">
  <thead>
    <tr>
      <th>ID</th>
      <th>Mã</th>
      <th>Tên tuyến</th>
      <th>Điểm bắt đầu</th>
      <th>Điểm kết thúc</th>
      <th class="text-end">Thao tác</th>
    </tr>
  </thead>
  <tbody>
    {% for r in routes %}
    <tr>
      <td>{{ r.maTuyen }}</td>
      <td><span class="badge bg-secondary">{{ r.maHienThi }}</span></td>
      <td>{{ r.tenTuyen }}</td>
      <td>{{ r.diemBatDau }}</td>
      <td>{{ r.diemKetThuc }}</td>
      <td class="text-end">
        <a class="btn btn-sm btn-outline-secondary"
           href="{{ url_for('admin_route_stops', tuyen_id=r.maTuyen) }}">Trạm</a>

        <a class="btn btn-sm btn-outline-secondary"
           href="{{ url_for('admin_route_trips', tuyen_id=r.maTuyen) }}">Chuyến</a>

        <a class="btn btn-sm btn-outline-primary"
           href="{{ url_for('admin_routes', edit=r.maTuyen) }}">Sửa</a>

        <form method="post"
              action="{{ url_for('delete_route', tuyen_id=r.maTuyen) }}"
              style="display:inline;"
              onsubmit="return confirm('Xóa tuyến này? (chỉ xóa được khi đã xóa hết chuyến và trạm)');">
          <button class="btn btn-sm btn-outline-danger">Xóa</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="6" class="text-center text-muted">Chưa có tuyến nào.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
