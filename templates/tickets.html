{% extends "base.html" %}
{% block title %}Vé đã đặt{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Vé đã đặt</h2>
</div>

{% if tickets %}
<div class="table-responsive shadow-sm rounded bg-white">
  <table class="table table-hover mb-0 align-middle">
    <thead class="table-light">
      <tr>
        <th>Mã vé</th>
        <th>Tuyến</th>
        <th>Chuyến</th>
        <th>Ngày</th>
        <th>Giờ</th>
        <th>Ghế</th>
        <th>Giá</th>
        <th>Mã hóa đơn</th>
        <th class="text-center">Trạng thái</th>
      </tr>
    </thead>
    <tbody>
      {% for ve in tickets %}
      <tr>
        <td>#{{ ve.maVe }}</td>
        <td>{{ ve.chuyen.tuyen.maHienThi }} – {{ ve.chuyen.tuyen.tenTuyen }}</td>
        <td>{{ ve.chuyen.maChuyen }}</td>
        <td>{{ ve.chuyen.ngayKhoiHanh }}</td>
        <td>{{ ve.chuyen.gioKhoiHanh }}</td>
        <td>
          {# nếu soGhe là số, padding 2 chữ số, vd 01, 12... #}
          {% if ve.soGhe.isdigit() %}
            {{ "%02d"|format(ve.soGhe|int) }}
          {% else %}
            {{ ve.soGhe }}
          {% endif %}
        </td>
        <td>{{ "{:,.0f}".format(ve.giaVe) }} đ</td>
        <td>{{ ve.hoa_don.maHoaDon }}</td>
        <td class="text-center">
          {% if ve.trangThai == 'DA_HUY' %}
            <span class="badge bg-secondary">Đã hủy</span>
          {% else %}
            <form method="post"
                  action="{{ url_for('cancel_ticket', ve_id=ve.maVe) }}"
                  class="d-inline">
              <button type="submit"
                      class="btn btn-sm btn-outline-danger"
                      onclick="return confirm('Bạn chắc chắn muốn hủy vé #{{ ve.maVe }}?');">
                Hủy vé
              </button>
            </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
  <p>Bạn chưa đặt vé nào.</p>
{% endif %}
{% endblock %}
