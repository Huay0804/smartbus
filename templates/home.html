{% extends "base.html" %}
{% block title %}Trang chủ{% endblock %}

{% block content %}
<section class="sb-user-home">

  <!-- TOP CARD -->
  <div class="sb-user-hero">
    <div class="sb-user-hero-left">
      <h1 class="sb-user-title">Tra cứu tuyến xe buýt Đà Nẵng</h1>
      <p class="sb-user-subtitle">
        Tìm tuyến, xem trạm trên bản đồ và xem chi tiết lộ trình.
      </p>

      <form class="sb-user-search" action="{{ url_for('routes') }}" method="get">
        <input class="form-control form-control-lg"
               name="q"
               placeholder="Nhập mã tuyến (VD: 01) hoặc tên tuyến (VD: Hội An)…">
        <button class="btn btn-primary btn-lg" type="submit">Tra cứu</button>
      </form>

      <div class="sb-user-actions">
        <a class="btn btn-outline-dark" href="{{ url_for('routes') }}">Xem tất cả tuyến</a>

        {% if user %}
          <a class="btn btn-outline-dark" href="{{ url_for('tickets') }}">Vé / hoá đơn của tôi</a>
        {% else %}
          <a class="btn btn-dark" href="{{ url_for('login') }}">Đăng nhập</a>
          <a class="btn btn-outline-dark" href="{{ url_for('register') }}">Đăng ký</a>
        {% endif %}
      </div>

      <div class="sb-user-hints">
        <div class="sb-hint"><span class="sb-hint-dot"></span> Xem tuyến trên bản đồ</div>
        <div class="sb-hint"><span class="sb-hint-dot"></span> Xem chi tiết trạm</div>
        <div class="sb-hint"><span class="sb-hint-dot"></span> Đặt vé theo chuyến (nếu có dữ liệu)</div>
      </div>
    </div>

    <div class="sb-user-hero-right">
      <div class="sb-user-preview">
        <div class="sb-user-preview-top">
          <div class="sb-user-preview-title">Gợi ý tuyến phổ biến</div>
          <!-- bỏ nút “Mở bản đồ” -->
        </div>

        <div class="sb-user-chips">
          {% for r in featured_routes %}
            <a class="sb-user-chip" href="{{ url_for('route_detail', tuyen_id=r.maTuyen) }}">
              <span class="sb-chip-code">{{ r.maHienThi }}</span>
              <span class="sb-chip-name">{{ r.tenTuyen }}</span>
            </a>
          {% else %}
            <div class="text-muted">Chưa có dữ liệu tuyến.</div>
          {% endfor %}
        </div>

        <div class="sb-user-note text-muted small">
          * Dữ liệu đang ở chế độ mô phỏng phục vụ demo môn học.
        </div>
      </div>
    </div>
  </div>

  <!-- MAP PREVIEW (fill the empty space) -->
  <div class="sb-home-map mt-3">
    <div class="sb-home-map-head">
      <div>
        <div class="sb-home-map-title">Bản đồ</div>
        <div class="sb-home-map-sub">Xem nhanh khu vực Đà Nẵng. Bản đồ tuyến chi tiết nằm trong trang “Tuyến xe”.</div>
      </div>
    </div>

    <div id="home-map" class="sb-home-map-canvas"></div>
  </div>

</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const el = document.getElementById("home-map");
    if (!el || !window.L) return;

    const map = L.map("home-map", { zoomControl: true });
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors",
    }).addTo(map);

    // Center Da Nang
    map.setView([16.0544, 108.2022], 12);

    // Optional: a subtle marker at center
    L.circleMarker([16.0544, 108.2022], { radius: 6 }).addTo(map)
      .bindPopup("Trung tâm Đà Nẵng (preview)");
  });
</script>
{% endblock %}
